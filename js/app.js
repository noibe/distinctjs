/**
 * Created by Eduardo Barros on 29/11/2014.
 */

/**
 * Pierre Rossignol - http://www.pierrerossignol.fr -
 * @version v1.0
 */

this.number=this._domElem.find(".content em"),this.title=this._domElem.find(".content h3"),this.sep=this._domElem.find(".content .sep"),this.textContainer=this._domElem.find(".content p"),this.illustration=this._domElem.find(".illustration"),this.controls=this._domElem.find(".controls"),this.counter=this.controls.find("strong"),this.createScene(),this.backgroundContainer=this._domElem.find(".background"),this.reduceLink=this._domElem.find(".reduce"),this.bindReduceLink()},UspSidebar.prototype.createScene=function(){this.scene=new Canva({id:"usp-sidebar-canvas",container:this._domElem,width:440,height:this.containerHeight}),this.sceneHover=new Canva({id:"usp-sidebar-hover-canvas",container:this._domElem,width:440,height:this.containerHeight})},UspSidebar.prototype.drawBackground=function(t){this.scene.clear(!0),t||(t=this.nextId),this.scene.context.globalCompositeOperation="source-over";var e=this.keypoints[t].images["blur-"+t],i=app._w,s=i/this.ratio;s<this.containerHeight&&(s=this.containerHeight,i=s*this.ratio);var o=(app._w-i)/2-app._w+440,a=(this.containerHeight-s)/2;this.scene.context.drawImage(e,o,a,i,s),this.scene.context.globalCompositeOperation="source-over",this.scene.context.fillStyle="rgba(255,255,255,0.6)",this.scene.context.beginPath(),this.scene.context.moveTo(0,0),this.scene.context.lineTo(440,0),this.scene.context.lineTo(440,this.containerHeight),this.scene.context.lineTo(0,this.containerHeight),this.scene.context.closePath(),this.scene.context.fill();var n=2*app._mainContainerHeight;this.scene.context.globalCompositeOperation="destination-out",this.scene.context.fillStyle="#08b9f3",this.scene.context.beginPath(),this.scene.context.moveTo(0,0),this.scene.context.lineTo(440-this.guideTop.x,0),this.scene.context.lineTo(440-this.guide.x,n),this.scene.context.lineTo(0,n),this.scene.context.lineTo(0,0),this.scene.context.closePath(),this.scene.context.fill(),this.isReduced&&(this.scene.context.globalCompositeOperation="destination-out",this.scene.context.fillStyle="#08b9f3",this.scene.context.beginPath(),this.scene.context.moveTo(0,0),this.scene.context.lineTo(390,0),this.scene.context.lineTo(390,n),this.scene.context.lineTo(0,n),this.scene.context.lineTo(0,0),this.scene.context.closePath(),this.scene.context.fill())},UspSidebar.prototype.bindReduceLink=function(){this.reduceLink.on("click",$.proxy(this.onReduceLinkClick,this))},UspSidebar.prototype.onReduceLinkClick=function(t){var e=this;t.preventDefault(),this.isReduced?(this.isReduced=!1,this.reduceLink.removeClass("on"),this._domElem.find(".reduced-controls").removeClass("on"),TweenMax.fromTo(this.guide,.7,{x:50},{x:440,ease:Quint.easeInOut,onUpdate:$.proxy(this.drawBackground,this),onComplete:function(){e.onSidebarFull()}}),TweenMax.fromTo(this.guideTop,.5,{x:50},{x:440,ease:Quint.easeInOut})):(this._domElem.removeClass("infos-on"),this.controls.removeClass("on"),this.reduceLink.removeClass("on"),TweenMax.fromTo(this.guide,.7,{x:440},{x:50,ease:Quint.easeInOut,onUpdate:$.proxy(this.drawBackground,this),onComplete:function(){e.onSidebarReduced()}}),TweenMax.fromTo(this.guideTop,.5,{x:440},{x:50,ease:Quint.easeInOut}))},UspSidebar.prototype.onSidebarReduced=function(){this._domElem.addClass("reduced"),this.keypointsSlug.length>1&&this._domElem.find